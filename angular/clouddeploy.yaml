apiVersion: deploy.cloud.google.com/v1
kind: DeliveryPipeline
metadata:
  name: angular-delivery-pipeline
  description: main application pipeline
serialPipeline:
  stages:
    - targetId: angular-deployment

---
apiVersion: deploy.cloud.google.com/v1
kind: Target
metadata:
  name: angular-deployment
  description: development cluster
gke:
  cluster: projects/incubation-ids/locations/europe-west1/clusters/demo-cluster-1

---
apiVersion: deploy.cloud.google.com/v1
kind: CanaryConfig
metadata:
  name: angular-canary-config
  description: Configuration for Canary Deployment
  spec:
    baseline:
      tag: latest
      numReplicas: 5
    canary:
      tag: canary
      numReplicas: 2
    analysis:
      metrics:
        - metric: request-duration
          threshold: 0.1
        - metric: error-rate
          threshold: 0.01
      interval: 1m
      tolerance: 0.05
